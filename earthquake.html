<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Earthquake Drill</title>
  <style>
    body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; background: #f9fafc; color: #333; scroll-behavior: smooth; }
    header { background: #d32f2f; color: white; padding: 2rem 1rem; text-align: center; }
    header h1 { margin: 0; font-size: 2.2rem; }
    header p { margin: 0.5rem 0 0; font-size: 1.1rem; }

    nav { background: #b71c1c; padding: 0.7rem 1rem; text-align: center; position: sticky; top: 0; z-index: 100; }
    nav a { color: white; margin: 0 1rem; text-decoration: none; font-weight: bold; transition: 0.3s; }
    nav a:hover { color: #ffd54f; }

    main { padding: 2rem 1rem; max-width: 900px; margin: auto; }
    section { background: #fff; padding: 2rem; border-radius: 0.5rem; box-shadow: 0 3px 8px rgba(0,0,0,0.1); margin-bottom: 2rem; }
    h2 { color: #d32f2f; margin-top: 0; }
    p { line-height: 1.6; }
    ul { margin: 0.5rem 0 0 1rem; }
    li { margin: 0.4rem 0; }

    button, .btn-link { padding: 0.7rem 1.3rem; border: none; border-radius: 0.3rem; cursor: pointer; font-size: 1rem; margin: 0.4rem 0.3rem; display: inline-block; text-decoration: none; }
    button:hover, .btn-link:hover { opacity: 0.9; }
    .btn-primary { background: #d32f2f; color: white; }
    .btn-secondary { background: #1976d2; color: white; }

    footer { background: #d32f2f; color: white; padding: 1rem; text-align: center; margin-top: 2rem; }

    /* Carousel Styles */
    .carousel {
      position: relative;
      width: 100%;
      max-width: 900px;   /* large enough for clarity */
      margin: 1.5rem auto;
      overflow: hidden;
      border-radius: 0.5rem;
    }
    .carousel-images {
      display: flex;
      transition: transform 0.6s ease-in-out;
    }
    .carousel-images img {
      width: 100%;
      height: 300px;            /* keep decent height */
      object-fit: cover;        /* fill neatly */
      flex-shrink: 0;
      border-radius: 0.5rem;
      image-rendering: -webkit-optimize-contrast; 
      image-rendering: crisp-edges;
      image-rendering: high-quality;
    }
    .carousel-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(0,0,0,0.5);
      color: white;
      border: none;
      padding: 0.5rem;
      cursor: pointer;
      border-radius: 50%;
      font-size: 1rem;
    }
    .prev { left: 10px; }
    .next { right: 10px; }

    /* Modal Styles */
    .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); }
    .modal-content { background: white; margin: 5% auto; padding: 20px; border-radius: 0.5rem; width: 90%; max-width: 800px; }
    .close { float: right; cursor: pointer; font-size: 22px; font-weight: bold; }
    video { width: 100%; border-radius: 0.5rem; margin-top: 1rem; }

    @media (max-width: 768px) {
      .btn-primary{
        margin-left: 15%;
      }
      .btn-link{
        margin-left: 15%;
        width:54.5%;
      }
    }
  </style>
</head>
<body>
  <!-- Hero Header -->
  <header id="home">
    <h1>Earthquake Drill</h1>
    <p>Stay calm. Stay safe. Be prepared when the ground shakes.</p>
  </header>

  <!-- Main Content -->
  <main>
    <section>
      <h2>Welcome</h2>
      <p>
        Welcome to the <strong>Earthquake Drill Training</strong>.  
        Earthquakes can happen anytime without warning. This program helps you 
        understand what to do before, during, and after an earthquake 
        to minimize risks and protect lives.
      </p>
    </section>

    <!-- Carousel -->
    <div class="carousel">
      <div class="carousel-images" id="carouselImages">
        <img src="quake1.jpg" alt="Earthquake safety drill image 1">
        <img src="quake2.webp" alt="Earthquake safety drill image 2">
        <img src="quake3.webp" alt="Earthquake safety drill image 3">
      </div>
      <button class="carousel-btn prev" onclick="prevSlide()">‚ùÆ</button>
      <button class="carousel-btn next" onclick="nextSlide()">‚ùØ</button>
    </div>

    <!-- Safety Tips -->
    <section id="tips">
      <h2>Earthquake Safety Tips</h2>
      <ul>
        <li>üßé <strong>Drop</strong> to your hands and knees immediately.</li>
        <li>üõ° <strong>Cover</strong> your head and neck under sturdy furniture.</li>
        <li>‚úã <strong>Hold On</strong> until the shaking stops.</li>
        <li>üö™ Avoid doorways; move away from windows and glass.</li>
        <li>üèû If outdoors, move to an open area away from buildings and power lines.</li>
        <li>üöó If driving, stop safely and stay inside your vehicle.</li>
      </ul>
    </section>

    <!-- Learn More -->
    <section id="learn">
      <h2>Learn More</h2>
      <p>Watch this earthquake drill training video to understand safety procedures.</p>
      <button class="btn-primary" onclick="openModal('videoModal')">üì∫ Watch Video Guide</button>
      <a href="earthquakequiz.html" class="btn-link btn-secondary">‚ùì Take Quiz Game</a>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    <p>&copy; 2025 Earthquake Drill Training</p>
  </footer>

  <!-- Video Modal -->
  <div id="videoModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal('videoModal')">&times;</span>
    <h2>Earthquake Drill Video Guide</h2>
    <iframe width="800" height="315" 
            src="https://www.youtube.com/embed/_UeiW79kNz0" 
            title="YouTube video player" 
            frameborder="0" 
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
            allowfullscreen>
    </iframe>
  </div>
</div>


  <script>
    // Carousel
    let currentIndex = 0;
    const images = document.getElementById("carouselImages");
    const totalSlides = images.children.length;

    function showSlide(index) {
      if(index >= totalSlides) currentIndex = 0;
      else if(index < 0) currentIndex = totalSlides - 1;
      else currentIndex = index;
      images.style.transform = `translateX(-${currentIndex * 100}%)`;
    }
    function nextSlide(){ showSlide(currentIndex + 1); }
    function prevSlide(){ showSlide(currentIndex - 1); }
    setInterval(() => { nextSlide(); }, 2000);

    // Modal
    function openModal(id){ document.getElementById(id).style.display='block'; }
    function closeModal(id){ document.getElementById(id).style.display='none'; }
    window.onclick = function(event) {
      const modal = document.getElementById('videoModal');
      if(event.target == modal){ closeModal('videoModal'); }
    }

  async function saveEarthquakeDrill(scorePercentage) {
  const token = localStorage.getItem('token');
  if (!token) {
    alert('You must be logged in to save your progress.');
    window.location.href = 'login.html';
    return;
  }

  try {
    // 1Ô∏è‚É£ Mark Earthquake Drill completed (backend should increment drill count)
    const drillRes = await fetch('https://login-relt.onrender.com/api/students/complete-drill', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({ drillId: 2 }) // Earthquake Drill
    });

    if (!drillRes.ok) {
      const data = await drillRes.json();
      alert(`Failed to record drill completion: ${data.message}`);
      return;
    }

    // 2Ô∏è‚É£ Update preparedness score
    const scoreRes = await fetch('https://login-relt.onrender.com/api/students/update', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${token}`
      },
      body: JSON.stringify({ preparednessScore: scorePercentage })
    });

    if (!scoreRes.ok) {
      const data = await scoreRes.json();
      alert(`Failed to update preparedness score: ${data.message}`);
      return;
    }

    alert('‚úÖ Earthquake Drill completed and score recorded!');
    window.location.href = 'student-dashboard.html';

  } catch (error) {
    console.error('Error saving drill:', error);
    alert('An error occurred while saving your progress.');
  }
}

  </script>
</body>
</html>